(this.webpackJsonpdemo1=this.webpackJsonpdemo1||[]).push([[18],{1139:function(e,t,a){"use strict";var n=a(0),r=a.n(n),c=a(393);t.a=function(e){return r.a.createElement("div",null,r.a.createElement(c.a,{size:"lg",dialogClassName:"modal-90w",show:e.open,onHide:e.handleClose,centered:!0},r.a.createElement(c.a.Header,{closeButton:!0},r.a.createElement(c.a.Title,null,e.title)),r.a.createElement(c.a.Body,null,e.children)))}},1441:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(195),l=a(45),i=a(1259),s=a.n(i),o=a(118),m=a(38),u=a(1091),d=a(1111),p=a(1088),h=a(99),f=a(78),E=a(42),b=a(37),v=a.n(b),g=a(87),k=(a(477),a(695)),j=a(39),x=a.n(j),y="http://api.thecrmnetwork.com";function O(e){return x.a.post("".concat(y,"/").concat("api/supportticket","/"),e)}function w(e){return x.a.post("".concat(y,"/").concat("attachment"),e)}function C(e){return x.a.get("".concat(y,"/").concat("attachment","/").concat(e))}function N(e){return x.a.delete("".concat(y,"/").concat("api/supportticket","/").concat("attachment","/").concat(e))}var S={"content-type":"multipart/form-data"};function A(e){var t=new FormData,a="".concat(y,"/").concat("api/fileupload");return t.append("files",e),Object(j.post)(a,t,S)}var T=a(1439),I=a(1447),_=a(1139),F=a(369),H=a(1117),L=a(1098),P=a(1097),U=a(370),z=a(218),D=a(1159),R=a.n(D),M=a(1105),B=a(1106),W=a(1079),G=a(1107),q=function(e){return r.a.createElement("form",{onSubmit:e.handleSubmit},r.a.createElement(M.a,null,r.a.createElement(B.a,null,r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,{className:"mb-4"},r.a.createElement(F.a,{onChange:e.handleChange,id:"subject",label:"Subject",className:"",value:e.data.subject,variant:"outlined",InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,required:!0}))),r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,{className:"mb-4"},r.a.createElement(F.a,{onChange:e.handleChange,id:"description",label:"Description",className:"",value:e.data.description,variant:"outlined",InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,rows:4,multiline:!0,required:!0}))),r.a.createElement(W.a,{xs:12},r.a.createElement(H.a,null,r.a.createElement(L.a,{expandIcon:r.a.createElement(R.a,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},"Attachments"),r.a.createElement(P.a,null,r.a.createElement(U.a,{type:"file"})))),r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,null,r.a.createElement(z.a,{type:"submit",size:"large",className:"float-right mt-3",variant:"contained",color:"primary"},"Confirm"))))))},K=function(e){var t=Object(n.useState)(0),a=Object(l.a)(t,2),c=a[0],i=a[1],s=e.props,o=Object(n.useState)(!1),m=Object(l.a)(o,2),u=m[0],d=m[1],p=Object(n.useState)(!1),h=Object(l.a)(p,2),b=h[0],j=(h[1],Object(n.useState)({id:"",subject:"",description:""})),w=Object(l.a)(j,2),C=w[0],N=w[1],S=Object(n.useState)(!1),A=Object(l.a)(S,2),F=A[0],H=A[1];Object(n.useEffect)((function(){i(0),function(){var e=Object(g.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.get("".concat(y,"/").concat("api/supportticket","/closed"));case 2:t=e.sent,i({columns:[{title:"Action",render:function(e){return r.a.createElement("a",{onClick:function(){return L(e)}},r.a.createElement(I.a,{twoToneColor:"#1a88d9"}))}},{title:"Status",dataIndex:"status"},{title:"Ticket#",dataIndex:"ticketNumber"},{title:"Subject",dataIndex:"subject"},{title:"Requested On",dataIndex:"dateCreated",render:function(e){return"".concat(k(e).format("LLL"))}}],data:t.data.reverse()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[F]);var L=function(e){s.history.push({pathname:"supports/".concat(e.id),data:e})},P=function(){var e=Object(g.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=Object(E.a)({},C,{businessId:"R2PPfBhpaLA."}),!b)try{O(a)}catch(n){}d(!1),H(!F);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{type:"ticket",title:"Support Ticket",open:u,handleClose:function(){d(!1)}},r.a.createElement(q,{data:C,handleChange:function(e){N(Object(E.a)({},C,Object(f.a)({},e.target.id,e.target.value)))},handleSubmit:P})),r.a.createElement(T.a,{columns:c.columns,dataSource:c.data,title:function(){return""},bordered:!0,size:"small",showHeader:!0,loading:!c.data}))},J=function(e){var t=Object(n.useState)(0),a=Object(l.a)(t,2),c=a[0],i=a[1],s=e.props,o=Object(n.useState)(!1),m=Object(l.a)(o,2),u=m[0],d=m[1],p=Object(n.useState)(!1),h=Object(l.a)(p,2),b=h[0],j=(h[1],Object(n.useState)({id:"",subject:"",description:""})),w=Object(l.a)(j,2),C=w[0],N=w[1],S=Object(n.useState)(!1),A=Object(l.a)(S,2),F=A[0],H=A[1];Object(n.useEffect)((function(){i(0),function(){var e=Object(g.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.get("".concat(y,"/").concat("api/supportticket","/active"));case 2:t=e.sent,i({columns:[{title:"Action",render:function(e){return r.a.createElement("a",{onClick:function(){return L(e)}},r.a.createElement(I.a,{twoToneColor:"#1a88d9"}))}},{title:"Status",dataIndex:"status"},{title:"Ticket#",dataIndex:"ticketNumber"},{title:"Subject",dataIndex:"subject"},{title:"Requested On",dataIndex:"dateCreated",render:function(e){return"".concat(k(e).format("LLL"))}}],data:t.data.reverse()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[F]);var L=function(e){s.history.push({pathname:"supports/".concat(e.id),data:e})},P=function(){var e=Object(g.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=Object(E.a)({},C,{businessId:"R2PPfBhpaLA."}),!b)try{O(a)}catch(n){}d(!1),H(!F);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{type:"ticket",title:"Support Ticket",open:u,handleClose:function(){d(!1)}},r.a.createElement(q,{data:C,handleChange:function(e){N(Object(E.a)({},C,Object(f.a)({},e.target.id,e.target.value)))},handleSubmit:P})),r.a.createElement(T.a,{columns:c.columns,dataSource:c.data,title:function(){return""},bordered:!0,size:"small",showHeader:!0,loading:!c.data}))},V=a(209),Z=a(17),Q=a(18),X=a(220),Y=a(22),$=a(21),ee=a(1442),te=a(23),ae=a(1062),ne=a(1089),re=a(636),ce=a(1096),le=a(252),ie=a(1060),se=a(1100),oe=a(1121),me=a.n(oe),ue=a(1213),de=a.n(ue),pe=a(1236),he=a.n(pe),fe=a(243),Ee=a(33),be=a(1384);new(a.n(be).a)({bucketName:"thecrmnetwork",dirName:"support/attachment",region:"us-west-1",accessKeyId:"AKIAICMNLMF3VSYJLJ5Q",secretAccessKey:"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"});function ve(e){return console.log("".concat("http://api.thecrmnetwork.com","/api/fileupload"),e),x.a.post("".concat("http://api.thecrmnetwork.com","/api/fileupload"),e)}var ge=function(e){return{root:{flexGrow:1},paper:{textAlign:"center"},wrapper:{position:"relative",width:"100%"},buttonProgress:{color:fe.a[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}},ke=function(e){Object(Y.a)(a,e);var t=Object($.a)(a);function a(e){var n;return Object(Z.a)(this,a),(n=t.call(this,e)).onChangeHandler=function(e){var t={name:e.target.files[0].name};n.setState({selectedFile:e.target.files[0],loaded:0,isUploaded:!0,isTemp:!0,tempAttachment:[].concat(Object(V.a)(n.state.tempAttachment),[t])})},n.state={tempAttachment:[],loading:!1,isUploaded:!1,description:"",subject:"",user:n.props.user,open:!1,message:""},n.class=ge(),n.descriptionHandler=n.descriptionHandler.bind(Object(X.a)(n)),n.subjectHandler=n.subjectHandler.bind(Object(X.a)(n)),n.saveTicket=n.saveTicket.bind(Object(X.a)(n)),n}return Object(Q.a)(a,[{key:"descriptionHandler",value:function(e){this.setState({description:e.target.value})}},{key:"subjectHandler",value:function(e){this.setState({subject:e.target.value})}},{key:"saveTicket",value:function(){var e=this;this.saveTicketFunction().then((function(t){e.setState({description:"",subject:"",tempAttachment:[],open:!0,message:"Ticket Saved"})})).catch((function(e){console.log(e)})),setTimeout((function(){return e.setState({open:!1,message:""})}),5e3)}},{key:"saveTicketFunction",value:function(){var e=Object(g.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveTicketSupport();case 2:return t=e.sent,e.next=5,this.uploadToAws();case 5:if(!(a=e.sent).data[0]){e.next=10;break}return e.next=9,this.saveAttachmentToTicket({upload:a,ticket:t});case 9:e.sent;case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveTicketSupport",value:function(){var e=this;return new Promise((function(t,a){O({businessId:e.state.user.id,userId:e.state.user.mainRole.business.id,subject:e.state.subject,description:e.state.description}).then((function(e){return t(e.data)})).catch((function(e){return a(e)}))}))}},{key:"uploadToAws",value:function(){var e=this;return new Promise((function(t,a){e.state.selectedFile?A(e.state.selectedFile).then((function(e){return t(e)})).catch((function(e){return a(e)})):t(!1)}))}},{key:"saveAttachmentToTicket",value:function(e){var t=this;return new Promise((function(a,n){var r=e.upload.data[0];w({supportTicketId:e.ticket.id,filePath:r.fileURL,fileName:Object(Ee.a)(r.fileURL),userId:t.state.user.id}).then((function(e){return a(e)})).catch((function(e){return n(e)}))}))}},{key:"renderTempAttachment",value:function(){return this.state.tempAttachment.length>=1?r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:"Filename"})),r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:"Action"})))),r.a.createElement(ce.a,{light:!0}),this.state.tempAttachment.map((function(e,t){return r.a.createElement(ae.a,{key:t},r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:e.name})),r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement("a",{href:"javascript_void(0)"},r.a.createElement(le.a,{"aria-label":"download"},r.a.createElement(de.a,{fontSize:"small"}))),r.a.createElement(le.a,{"aria-label":"Delete"},r.a.createElement(me.a,{fontSize:"small"})))))}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,null,"No Attachments"))}},{key:"render",value:function(){return r.a.createElement("div",{className:"kt-portlet kt-portlet--height-fluid"},r.a.createElement("div",{className:"kt-portlet__head"},r.a.createElement("div",{className:"kt-portlet__head-label"},r.a.createElement("h3",{className:"kt-portlet__head-title"},"Create New Ticket"))),r.a.createElement("div",{className:"kt-portlet__body"},r.a.createElement("div",{className:"kt-widget4"},r.a.createElement(ee.a,null,r.a.createElement(ee.a.Group,{controlId:"subject"},r.a.createElement(ee.a.Label,null,"Subject"),r.a.createElement(ee.a.Control,{type:"text",onChange:this.subjectHandler,value:this.state.subject})),r.a.createElement(ee.a.Group,{controlId:"description"},r.a.createElement(ee.a.Label,null,"Description"),r.a.createElement(ee.a.Control,{as:"textarea",rows:"3",onChange:this.descriptionHandler,value:this.state.description})),r.a.createElement(ee.a.Group,{controlId:"attachment"},r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(H.a,null,r.a.createElement(L.a,{expandIcon:r.a.createElement(R.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(h.a,{className:ge.heading},"Attachments")),r.a.createElement(P.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(h.a,null,"Note:Upload attachment extension allow:.pdf, .xlsx, .xls, .png, .doc, .docx, .jpg, .jpeg, .csv, .txt")),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement("input",{style:{display:"none"},id:"contained-button-file",type:"file",onChange:this.onChangeHandler}),r.a.createElement("label",{htmlFor:"contained-button-file"},r.a.createElement(z.a,{variant:"contained",color:"default",component:"span",startIcon:r.a.createElement(he.a,null)},"Upload"))),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ie.a,{component:"nav",className:ge.root,"aria-label":"Mailbox folders"},this.renderTempAttachment())))))))),r.a.createElement(ee.a.Group,{controlId:"savebtn"},r.a.createElement(z.a,{variant:"contained",color:"primary",onClick:this.saveTicket},"Save"))),r.a.createElement(se.a,{anchorOrigin:{vertical:"top",horizontal:"right"},open:this.state.open,message:this.state.message}))))}}]),a}(r.a.Component),je=(Object(te.b)((function(e){return{user:e.auth.user}}))(ke),a(1446)),xe=function(){var e={id:"",subject:"",description:"",attachments:""},t=Object(n.useState)(e),a=Object(l.a)(t,2),c=a[0],i=a[1],s=Object(n.useState)({fileName:"",filePath:""}),o=Object(l.a)(s,2),m=o[0],u=o[1],d=Object(n.useState)(!1),p=Object(l.a)(d,2),h=p[0],b=p[1],k=function(e){i(Object(E.a)({},c,Object(f.a)({},e.target.id,e.target.value)))},j=function(){var e=Object(g.a)(v.a.mark((function e(t){var a,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("files",t.target.files[0]),e.next=4,ve(a);case 4:n=e.sent,u({fileName:n.data[0].fileName,filePath:n.data[0].fileURL});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var t=Object(g.a)(v.a.mark((function t(a){var n,r,l;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),b(!0),n=Object(E.a)({},c,{businessId:"R2PPfBhpaLA."}),t.next=5,o=n,x.a.post("".concat(y,"/").concat("api/supportticket"),o);case 5:return r=t.sent,l=Object(E.a)({},m,{supportTicketId:r.data.id}),t.next=9,w(l);case 9:t.sent,i(e),u({fileName:"",filePath:""}),b(!1),s="Ticket submitted.",je.a.open({message:"Notification",description:"".concat(s),onClick:function(){}}),window.location.reload(!1);case 15:case"end":return t.stop()}var s,o}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("div",{className:"mt-5"},r.a.createElement("form",{onSubmit:O},r.a.createElement(B.a,null,r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,{className:"mb-4"},r.a.createElement(F.a,{onChange:k,id:"subject",label:"Subject",className:"",value:c.subject,variant:"outlined",InputLabelProps:{shrink:!0},size:"small",fullWidth:!0}))),r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,{className:"mb-4"},r.a.createElement(F.a,{onChange:k,id:"description",label:"Description",className:"",value:c.description,variant:"outlined",InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,rows:8,multiline:!0}))),r.a.createElement(W.a,{xs:12},r.a.createElement(H.a,null,r.a.createElement(L.a,{expandIcon:r.a.createElement(R.a,null),"aria-controls":"panel1bh-content",id:"panel1bh-header"},"Attachments"),r.a.createElement(P.a,null,r.a.createElement(U.a,{id:"attachments",type:"file",onChange:j})))),r.a.createElement(W.a,{xs:12},r.a.createElement(G.a,null,r.a.createElement(z.a,{type:"submit",size:"large",className:"float-right mt-3",variant:"contained",color:"secondary",disabled:h},"Confirm"))))))};function ye(e){var t=e.children,a=e.dir;return r.a.createElement(h.a,{component:"div",dir:a},t)}var Oe=Object(o.a)((function(e){return{root:{backgroundColor:e.palette.background.paper,width:"100%"}}}));function we(e){var t=Oe(),a=Object(m.a)(),n=r.a.useState(0),c=Object(l.a)(n,2),i=c[0],o=c[1];return r.a.createElement("div",{className:t.root},r.a.createElement(u.a,{position:"static",color:"default"},r.a.createElement(d.a,{value:i,onChange:function(e,t){o(t)},indicatorColor:"secondary",textColor:"secondary",variant:"fullWidth"},r.a.createElement(p.a,{label:"Open"}),r.a.createElement(p.a,{label:"Closed"}),r.a.createElement(p.a,{label:"Open a Ticket"}))),r.a.createElement(s.a,{axis:"rtl"===a.direction?"x-reverse":"x",index:i,onChangeIndex:function(e){o(e)}},r.a.createElement(ye,{dir:a.direction},r.a.createElement(J,{props:e})),r.a.createElement(ye,{dir:a.direction},r.a.createElement(K,{props:e})),r.a.createElement(ye,{dir:a.direction},r.a.createElement(xe,{props:e}))))}var Ce=a(86),Ne=function(e){Object(Y.a)(a,e);var t=Object($.a)(a);function a(e){var n;return Object(Z.a)(this,a),(n=t.call(this,e)).handleCloseEvent=n.handleCloseEvent.bind(Object(X.a)(n)),n}return Object(Q.a)(a,[{key:"handleCloseEvent",value:function(){this.props.handleClose(!0)}},{key:"render",value:function(){return r.a.createElement(Ce.a,{className:"kt-portlet__head-toolbar",drop:"down",alignRight:!0},r.a.createElement(Ce.a.Toggle,{variant:"transparent",className:"btn btn-label-success btn-sm btn-bold dropdown-toggle",id:"dropdown-toggle-top"},"Action"),r.a.createElement(Ce.a.Menu,{className:"dropdown-menu-fit dropdown-menu-right"},r.a.createElement("ul",{className:"kt-nav"},r.a.createElement("li",{className:"kt-nav__item"},r.a.createElement("a",{href:"#",className:"kt-nav__link",onClick:this.handleCloseEvent},r.a.createElement("i",{className:"kt-nav__link-icon flaticon-close"}),r.a.createElement("span",{className:"kt-nav__link-text"},"Cancel"))))))}}]),a}(r.a.Component),Se=a(1219),Ae=a.n(Se),Te=a(1419),Ie=a.n(Te),_e=a(624),Fe=function(e){Object(Y.a)(a,e);var t=Object($.a)(a);function a(e){var n;return Object(Z.a)(this,a),(n=t.call(this,e)).state={data:null},n.deleteAttachmentHandler=n.deleteAttachmentHandler.bind(Object(X.a)(n)),n}return Object(Q.a)(a,[{key:"componentDidMount",value:function(){this.setState({data:this.props.data})}},{key:"UNSAFE_componentWillReceiveProps",value:function(){this.setState({data:this.props.data})}},{key:"downloadFile",value:function(e){var t={file:e};window.location.href=t.file}},{key:"deleteAttachmentHandler",value:function(){var e=Object(g.a)(v.a.mark((function e(t){var a,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:return a=e.sent,e.next=5,C(a.data.id);case 5:n=e.sent,this.props.onAttachmentChanged(n.data);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderAttachments",value:function(){var e=this;if(this.state.data)return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:this.state.data.fileName?this.state.data.fileName:Object(Ee.a)(this.state.data.filePath)})),r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement("a",{href:this.state.data.filePath,download:this.state.data.filePath,target:"_blank"},r.a.createElement(le.a,{"aria-label":"download"},r.a.createElement(de.a,{fontSize:"small"}))),r.a.createElement(le.a,{"aria-label":"Delete",onClick:function(){return e.deleteAttachmentHandler(e.state.data.id)}},r.a.createElement(me.a,{fontSize:"small"}))))),r.a.createElement(ce.a,{light:!0}))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.renderAttachments())}}]),a}(r.a.Component),He=function(e){return{root:{flexGrow:1},paper:{textAlign:"center"},wrapper:{position:"relative",width:"100%"},buttonProgress:{color:fe.a[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}},Le=function(e){Object(Y.a)(a,e);var t=Object($.a)(a);function a(e){var n;return Object(Z.a)(this,a),(n=t.call(this,e)).handleAttachment=function(e){n.setState({attachments:e})},n.onChangeHandler=function(e){var t={name:e.target.files[0].name};n.setState({selectedFile:e.target.files[0],loaded:0,isUploaded:!0,isTemp:!0,tempAttachment:[].concat(Object(V.a)(n.state.tempAttachment),[t])})},n.handleCloseEvent=function(){var e=Object(g.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:n.state.id,businessId:n.state.ticket.businessId,status:"Cancelled"},e.next=3,t=a,x.a.patch("".concat(y,"/").concat("api/supportticket"),t);case 3:e.sent,window.location.href="/supports";case 5:case"end":return e.stop()}var t}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onchangeCommentHandler=function(e){n.setState({comment:e.target.value})},n.state={selectedFile:null,isUploaded:!1,toggleForm:!1,isTemp:!0,tempAttachment:[],loading:!1,open:!1,id:n.props.match.params.id},n.onChangeHandler=n.onChangeHandler.bind(Object(X.a)(n)),n.handleAttachment=n.handleAttachment.bind(Object(X.a)(n)),n.onchangeCommentHandler=n.onchangeCommentHandler.bind(Object(X.a)(n)),n.onUpload=n.onUpload.bind(Object(X.a)(n)),n.class=He(),n}return Object(Q.a)(a,[{key:"componentDidMount",value:function(){this.geSupportTicketData(),this.getSupportAttachment(),this.getSupportCommentById()}},{key:"geSupportTicketData",value:function(){var e,t=this;(e=this.state.id,x.a.get("".concat(y,"/").concat("api/supportticket","/").concat(e))).then((function(e){return t.setState({ticket:e.data})})).catch((function(e){return console.log(e)}))}},{key:"getSupportAttachment",value:function(){var e=this;C(this.state.id).then((function(t){return e.setState({attachments:t.data})})).catch((function(e){return console.log(e)}))}},{key:"getSupportCommentById",value:function(){var e,t=this;(e=this.state.id,x.a.get("".concat(y,"/").concat("comment","/").concat(e))).then((function(e){return t.setState({comments:e.data})})).catch((function(e){return console.log(e)}))}},{key:"onUpload",value:function(){var e=this;this.setState({loading:!0}),A(this.state.selectedFile).then((function(t){e.saveAttachment(t).then((function(t){e.setState({loading:!1,open:!0,isTemp:!1,isUploaded:!1,message:"Upload complete",responseData:t}),setTimeout((function(){return e.setState({open:!1})}),4e3)})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}},{key:"saveAttachment",value:function(e){var t=this;return new Promise((function(a,n){var r=e.data[0];w({supportTicketId:t.state.ticket.id,filePath:r.fileURL,fileName:Object(Ee.a)(r.fileURL),userId:t.props.user.id}).then((function(e){t.getSupportAttachment(),a(e)})).catch((function(e){return console.log(e)}))}))}},{key:"saveCommentHandler",value:function(){var e=Object(g.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={supportTicketId:this.state.id,userId:this.props.user.id,comment:this.state.comment},e.next=3,a=t,x.a.post("".concat(y,"/").concat("comment"),a);case 3:e.sent,this.getSupportCommentById(),this.setState({comment:""});case 6:case"end":return e.stop()}var a}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderTempAttachment",value:function(){if(this.state.tempAttachment&&this.state.isTemp)return this.state.tempAttachment.map((function(e,t){return r.a.createElement(ae.a,{key:t},r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:e.name})),r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement("a",{href:"javascript_void(0)"},r.a.createElement(le.a,{"aria-label":"download"},r.a.createElement(de.a,{fontSize:"small"}))),r.a.createElement(le.a,{"aria-label":"Delete"},r.a.createElement(me.a,{fontSize:"small"})))))}))}},{key:"renderAttachment",value:function(){var e=this;return this.state.attachments?this.state.attachments.map((function(t,a){return r.a.createElement(Fe,{key:a,data:t,onAttachmentChanged:e.handleAttachment})})):r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,null,"No Attachments"))}},{key:"renderComment",value:function(){if(this.state.comments)return this.state.comments.map((function(e,t){return r.a.createElement(ie.a,{key:"comment-".concat(t),component:"nav",className:He.root,"aria-label":"Mailbox folders"},r.a.createElement(ae.a,null,r.a.createElement(h.a,null,e.user.firstName," ",e.user.lastName," added a comment -"," ",k(e.dateCreated).format("LLL"))),r.a.createElement(ae.a,null,r.a.createElement(h.a,null,e.comment)),r.a.createElement(ce.a,{light:!0}))}))}},{key:"commentForm",value:function(){var e=this;if(this.state.toggleForm)return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ie.a,{component:"nav",className:He.root,"aria-label":"Mailbox folders"},r.a.createElement(ae.a,null,r.a.createElement(F.a,{id:"outlined-multiline-static",label:"Comment",multiline:!0,rows:"4",className:He.textField,margin:"normal",variant:"outlined",onChange:this.onchangeCommentHandler,value:this.state.comment})))),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ae.a,null,r.a.createElement(z.a,{variant:"contained",color:"default",style:{marginRight:"20px"},onClick:function(){return e.setState({toggleForm:!1})}},"Cancel"),r.a.createElement(z.a,{variant:"contained",color:"primary",onClick:function(){return e.saveCommentHandler()}},"Save"))))}},{key:"render",value:function(){var e,t,a=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"kt-portlet"},r.a.createElement("div",{className:"kt-portlet__head"},r.a.createElement("div",{className:"kt-portlet__head-label"},r.a.createElement("h3",{className:"kt-portlet__head-title"},"Support Request")))),r.a.createElement("div",{className:"kt-portlet kt-portlet--height-fluid"},r.a.createElement("div",{className:"kt-portlet__head"},r.a.createElement("div",{className:"kt-portlet__head-label"},r.a.createElement("h3",{className:"kt-portlet__head-title"},"# ",this.state.ticket?this.state.ticket.ticketNumber:""," /"," ",this.state.ticket?this.state.ticket.subject:"")),(null===(e=this.state.ticket)||void 0===e?void 0:e.active)?r.a.createElement(Ne,{handleClose:this.handleCloseEvent}):null),r.a.createElement("div",{className:"kt-portlet__body"},r.a.createElement("div",{className:"kt-widget4"},r.a.createElement(ie.a,{component:"nav",className:He.root,"aria-label":"Mailbox folders"},r.a.createElement(ae.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:4},r.a.createElement(Ae.a,null)," ",this.state.ticket?this.state.ticket.user.firstName:""," ",this.state.ticket?this.state.ticket.user.lastName:""),r.a.createElement(ne.a,{item:!0,xs:4},r.a.createElement(Ie.a,null)," ",this.state.ticket?this.state.ticket.user.email:""),r.a.createElement(ne.a,{item:!0,xs:4},r.a.createElement("div",null," ",this.state.ticket?this.state.ticket.status:""," ")))),r.a.createElement(ce.a,{light:!0})),r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(h.a,{className:He.heading},"Description"),r.a.createElement("hr",null),r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(h.a,{style:{fontWeight:"bold",fontSize:20}},null===(t=this.state.ticket)||void 0===t?void 0:t.description))))),r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(H.a,null,r.a.createElement(L.a,{expandIcon:r.a.createElement(R.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(h.a,{className:He.heading},"Attachments")),r.a.createElement(P.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(h.a,null,"Note:Upload attachment extension allow:.pdf, .xlsx, .xls, .png, .doc, .docx, .jpg, .jpeg, .csv, .txt")),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement("input",{style:{display:"none"},id:"contained-button-file",type:"file",onChange:this.onChangeHandler}),r.a.createElement("label",{htmlFor:"contained-button-file"},r.a.createElement(z.a,{variant:"contained",color:"default",component:"span",startIcon:r.a.createElement(he.a,null)},"Upload"))),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ie.a,{component:"nav",className:He.root,"aria-label":"Mailbox folders"},r.a.createElement(ae.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"space-between"},r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:"Filename"})),r.a.createElement(ne.a,{item:!0,xs:6},r.a.createElement(re.a,{primary:"Action"})))),r.a.createElement(ce.a,{light:!0}),this.renderAttachment(),this.renderTempAttachment())),r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement("div",{style:this.class.wrapper},this.state.isUploaded&&r.a.createElement(z.a,{variant:"contained",color:"primary",style:this.class.wrapper,disabled:this.state.loading,onClick:this.onUpload},"Save"),this.state.loading&&r.a.createElement(_e.a,{size:24,style:this.class.buttonProgress})))))))),r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12})),r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(H.a,null,r.a.createElement(L.a,{expandIcon:r.a.createElement(R.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(h.a,{className:He.heading},"Comments")),r.a.createElement(P.a,null,r.a.createElement(ne.a,{container:!0,spacing:3,justify:"center"},r.a.createElement(ne.a,{item:!0,xs:12},this.renderComment()),!this.state.toggleForm&&r.a.createElement(ne.a,{item:!0,xs:12},r.a.createElement(ie.a,{component:"nav",className:He.root,"aria-label":"Mailbox folders"},r.a.createElement(ae.a,null,r.a.createElement(z.a,{variant:"contained",color:"primary",onClick:function(){return a.setState({toggleForm:!0})}},"Comment")))),this.commentForm())))))),r.a.createElement(se.a,{anchorOrigin:{vertical:"top",horizontal:"right"},open:this.state.open,message:this.state.message})))))}}]),a}(r.a.Component),Pe=Object(te.b)((function(e){return{user:e.auth.user}}))(Le);function Ue(){return r.a.createElement(c.g,null,r.a.createElement(c.c,{exact:!0,from:"/",to:"/supports"}),r.a.createElement(c.d,{path:"/supports/:id",component:Pe}),r.a.createElement(c.d,{path:"/supports",component:we}))}a.d(t,"default",(function(){return Ue}))}}]);
//# sourceMappingURL=18.bcd4f730.chunk.js.map